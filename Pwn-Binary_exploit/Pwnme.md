# Pwnme

![image](https://github.com/anhshidou/FUSec2024/assets/81132394/282477ad-19de-42ee-88db-810c0d42169c)

----
Đầu tiên khi đọc bài, ta biết luôn phải sử dụng buffer overflow. Mình sẽ tải thử cả 2 file được cung cấp về

**Source Code**
```
#include <stdio.h>
#include <unistd.h>
#include <stdlib.h>

void hacked()
{
    FILE *file = fopen("flag.txt", "r");
    if (file == NULL)
    {
        printf("Could not open file flag.txt\n");
        return;
    }

    char buffer[256]; // Buffer to hold the file contents

    printf("Flag content:\n");
    while (fgets(buffer, sizeof(buffer), file) != NULL)
    {
        printf("%s", buffer);
    }

    fclose(file);
    printf("\nThis function is TOP SECRET! How did you get in  :O\n");
}

void register_name()
{
    char buffer[16];
    

    printf("Name:\n");
    fflush(stdout);
    scanf("%s", buffer);
    printf("Hi there, %s\n", buffer);   
}

int main()
{
    
    register_name();

    return 0;
}
```

Với source code này, mình nhận ra chúng ta phải sử dụng buffer overflow để gọi function `hacked`. Bây giờ mình sử dụng ida kiểm tra xem địa chỉ lưu trữ function `hacked` ở đâu

![image](https://github.com/anhshidou/FUSec2024/assets/81132394/c716d748-1b42-4650-86b4-f6bcd856e6a4)

Nó ở địa chỉ 400707. Mình sẽ sử dụng lệnh `file` để kiểm tra xem nó là **MSB** hay **LSB**

![image](https://github.com/anhshidou/FUSec2024/assets/81132394/e9ce7445-8c1e-4a11-9008-fb6d5f96ccf9)

Vậy ta sẽ có payload như sau

`100000000000000000000000\x07\x07\x40`

![image](https://github.com/anhshidou/FUSec2024/assets/81132394/3d895a19-f5d8-409d-91b4-e99523547b42)

Thử nhập nó lên server

![image](https://github.com/anhshidou/FUSec2024/assets/81132394/3be66ff6-b049-4f72-881b-a2a89a769c78)

Có vẻ như nó lỗi

Mình quay lại ida để xem thì phát hiện ra ở địa chỉ đó, lệnh của nó là `push rbp`, mà tại đây base pointer của ta đang chưa có nên nó xảy ra lỗi. Mình thử đổi lại payload sao cho nó chỉ về `mov rbp, rsp`

`100000000000000000000000\x08\x07\x40`

![image](https://github.com/anhshidou/FUSec2024/assets/81132394/0ff3d3d5-e174-4c32-a53c-14aebba71262)

Cúng tìm hiểu thêm được lỗi `Segmentation fault (core dumped)` tức là chạy nhầm trên vùng nhớ nào đó, hoặc tràn bộ đệm \(Source: [https://daynhauhoc.com/](https://daynhauhoc.com/t/loi-segmentation-fault-core-dumped-la-loi-gi/11210)\)

Chạy thử payload này lên server

![image](https://github.com/anhshidou/FUSec2024/assets/81132394/cd115bd7-4940-48d6-b751-3155d0c5fa83)

Flag: `FUSec{On35H00tOnEkil1}`


